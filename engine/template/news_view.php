<?php // News information	if(isset($_GET['nid']) AND is_numeric($_GET['nid'])) {		$nid = $_GET['nid'];		$STH = $DB->query("SELECT n.n_id, n.n_title, n.n_title_en, n.n_text, n.n_text_en, n.n_add_user, n.n_add_time, u.u_id, u.u_login FROM t_news n INNER JOIN t_users u ON n.n_add_user=u.u_id WHERE n_id=$nid");		$newsInfo = $STH->fetch();	} else { echo "<div class='error'>Error</div>"; exit; }?><div id='mainbody'>	<?php // Messages tables		if(isset($_GET['st'])) {			switch ($_GET['st']) {				case 'addok': 					echo "<div class='ok'>".$lang['News added']."</div>";					break;				case 'editok':					echo "<div class='ok'>".$lang['News successfully edited']."</div>";					break;			}		}	?>	<div class='title'>	   <?php 		  if(!isset($_SESSION['uLANG']) OR $_SESSION['uLANG'] ==  'en') {			 echo $newsInfo['n_title_en']; 		  } else {			 echo $newsInfo['n_title']; 		  }	  ?>		  	  	  <?php 	    if(isset($_SESSION['uID']) and ($_SESSION['uGROUP'] == 1 OR $_SESSION['uGROUP'] == 2)) {  		  echo "<a href='news.php?sk=edit&amp;nid=".$newsInfo['n_id']."' style='font-size: 9px;'>				".$lang['Edit']."</a>";		}	  ?>	   	</div>		<?php // Vote information blocks		if(isset($_GET['mark'])) { 			if($_GET['mark']=='add') {				echo "<div class='ok'>".$lang['Thank you for rating']."</div>";			} elseif($_GET['mark']=='del') {				echo "<div class='ok'>".$lang['Mark deleted']."</div>";			}		}		if(isset($_GET['comment']) AND $_GET['comment'] == 'del') {				echo "<div class='ok'>".$lang['Comment deleted']."</div>";		}	?>			<div class='text'>	  <?php		 if(!isset($_SESSION['uLANG']) OR $_SESSION['uLANG'] ==  'en') {			echo $newsInfo['n_text_en'];		} else { 			echo $newsInfo['n_text'];		}	  ?>	</div>		<div class='pollLine'>	  <?php 		echo $lang['Author'].": <a href='user.php?id=".$newsInfo['u_id']."'>		".$newsInfo['u_login']."</a>".$lang['Date'];?>: <?=$newsInfo['n_add_time'];?>				<div class='pollForm'>		  <?php  // Vote block start			if(isset($_SESSION['uID'])) {				// Confirm repeat vote				$STH = $DB->query("SELECT count(*) AS countMarks FROM t_newsmarks WHERE m_uid=$_SESSION[uID] AND m_news=$nid");				$Marks = $STH->fetch();								if($Marks['countMarks'] != 0) {					// News raitinig					$STH = $DB->query("SELECT count(*) AS cMarks, SUM(m_mark) AS sumMarks FROM t_newsmarks WHERE m_news=$nid");					$markResult = $STH->fetch();					echo $lang['Raiting'].": ".$markResult['cMarks'].' '.						 $lang['All marks'].": ".round($markResult['sumMarks']/$markResult['cMarks'], 2)."<br />";										// Your mark					$STH = $DB->query("SELECT m_mark AS mark FROM t_newsmarks WHERE m_uid=$_SESSION[uID] AND m_news=$nid");					$uMark = $STH->fetch();					echo $lang['Your mark'].": ".$uMark['mark']." 						 <a href='engine/bin/delMark.php?nid=".$nid."'>".$lang['Delete mark']."</a>";				} else {					// Vote Form					echo " <form method='POST' action='engine/bin/addMark.php' name='voteForm'>								<input type='radio' name='mark' value='1' />1								<input type='radio' name='mark' value='2' />2								<input type='radio' name='mark' value='3' />3								<input type='radio' name='mark' value='4' />4								<input type='radio' name='mark' value='5' />5								<input type='hidden' name='nID' value='".$_GET['nid']."' />								<input type='submit' value='Проголосувати' />							</form>";				}			} else {				// News raiting				$STH = $DB->query("SELECT count(*) AS cMarks, SUM(m_mark) AS sumMarks FROM t_newsmarks WHERE m_news=$nid");				$markResult = $STH->fetch();				if($markResult['cMarks'] != 0) {					echo  $lang['All marks'].": ".$markResult['cMarks']." ".						  $lang['Raiting'].": ".round($markResult['sumMarks']/$markResult['cMarks'], 2);				} else { 					echo $lang['This material have not voted']; 				}			}		  ?>					</div>	</div>		<div class='clearfix'></div>		<div class='commentBlock'>		<?php			// if user auth include comment form			if(isset($_SESSION['uID'])) {				include('engine/template/commentForm.php');			} else {				echo"<div class='error'>".$lang['You can not add comment. Please sign up']."</div>";			}		?>	</div>	<div class='clearfix'></div>		<div class='commentFrom'>			<?php				// Select all comments this news				$STH = $DB->query("SELECT t.c_id, t.c_title, t.c_text, t.c_add_user, t.c_time, u.u_id, u.u_login FROM t_comments t INNER JOIN t_users u ON t.c_add_user=u.u_id WHERE c_news=$_GET[nid] ORDER BY c_id DESC");				if ($comment = $STH->fetch()) {					do {						echo "<div class='comment'>								<a href='user.php?id=".$comment['u_id']."' class='uLink'>".$comment['u_login']."</a>								<br />								<b>".$lang['Theme'].": ";																	// Slice comment theme (if need)									if($comment['c_title'] == '') { 										$p = strripos(substr($comment['c_text'],15,30),' ');										if($p != 0) {											echo  substr($comment['c_text'],0,$p).'...';										} else { echo  substr($comment['c_text'],0,15).'...';}									} else { 										echo $comment['c_title']; 									}														echo "</b>";						if($_SESSION['uGROUP'] == 1) { echo "<a href='engine/bin/deleteComment.php?delcom=".$comment['c_id']."' style='float: right;'>".$lang['Delete']."</a>";}						echo "	<br />".$comment['c_text']."<br />								<div class='desc'>".$comment['c_time']."</div>							   </div>";																	} while ($comment = $STH->fetch());				} else { echo "<div class='centr'>No comments</div>"; }							?>	</div></div></div>